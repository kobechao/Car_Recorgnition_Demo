<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>中古車拍賣</title>
  <meta content="" name="description">
  <meta content="width=device-width, initial-scale=1" name="viewport">
  <link rel="stylesheet" href="{{ url_for( 'static', filename='css/bootstrap.min.css' )}}">
  <!-- Font Awesome CSS-->
  <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.0.13/css/all.css">
  <link rel="stylesheet" href="{{ url_for( 'static', filename='css/font-awesome.min.css' )}}"> 
  <!-- Fontastic Custom icon font-->
  <link rel="stylesheet" href="{{ url_for( 'static', filename='css/fontastic.css' )}}">
  <!-- jQuery Circle-->
  <link rel="stylesheet" href="{{ url_for( 'static', filename='css/grasp_mobile_progress_circle-1.0.0.min.css' )}}">
  <!-- Custom Scrollbar-->
   <link rel="stylesheet" href="{{ url_for( 'static', filename='css/jquery.mCustomScrollbar.css' )}}">
  <!-- theme stylesheet-->
  <link rel="stylesheet" href="{{ url_for( 'static', filename='css/style.default.css' )}}">
  <!-- Custom stylesheet - for your changes-->
  <link rel="stylesheet" href="{{ url_for( 'static', filename='css/custom.css') }}">
  <!-- Favicon-->
  <link rel="shortcut icon" href="{{ url_for( 'static', filename='img/favicon.ico') }}">
  <!-- Bootstrap CSS-->
  <!-- <link href="../static/css/bootstrap.min.css" rel="stylesheet"> --><!-- Font Awesome CSS-->
  <!-- <link href="https://use.fontawesome.com/releases/v5.0.13/css/all.css" rel="stylesheet"> -->
  <!-- <link href="../static/css/font-awesome.min.css" rel="stylesheet"> --><!-- Fontastic Custom icon font-->
  <!-- <link href="../static/css/fontastic.css" rel="stylesheet"> --><!-- jQuery Circle-->
  <!-- <link href="../static/css/grasp_mobile_progress_circle-1.0.0.min.css" rel="stylesheet"> --><!-- Custom Scrollbar-->
  <!-- <link href="../static/css/jquery.mCustomScrollbar.css" rel="stylesheet"> --><!-- theme stylesheet-->
  <!-- <link href="../static/css/style.default.css" rel="stylesheet"> --><!-- Custom stylesheet - for your changes-->
 <!--  <link href="../static/css/custom.css" rel="stylesheet"> --><!-- Favicon-->
 <!--  <link href="../static/img/favicon.ico" rel="shortcut icon"> -->
</head>
<body>
  <!-- Side Navbar -->
  <nav class="side-navbar">
    <div class="side-navbar-wrapper">
      <!-- Sidebar Header    -->
      <div class="sidenav-header d-flex align-items-center justify-content-center">
        <!-- User Info-->
        <div class="sidenav-header-inner text-center">
          <a href="profile.html"></a>
          <h2 class="h5" id="username">中古車拍賣</h2><span></span>
        </div><!-- Small Brand information, appears on minimized sidebar-->
        <div class="sidenav-header-logo">
          <a class="brand-small text-center" href="/index"><strong></strong><strong class="text-primary"></strong></a>
        </div>
      </div><!-- Sidebar Navigation Menus-->
      <div class="main-menu">
        <h5 class="sidenav-heading"></h5>
        
      </div>
    </div>
  </nav>
  <div class="page">
    <!-- navbar-->
    <header class="header">
      <nav class="navbar">
        <div class="container-fluid">
          <div class="navbar-holder d-flex align-items-center justify-content-between">
            <div class="navbar-header">
              <a class="menu-btn" href="#" id="toggle-btn"><i class="icon-bars"></i></a> <a class="navbar-brand" href="/index">
              <div class="brand-text d-none d-md-inline-block">
                <strong class="text-primary"><i class="fas fa-shopping-cart"></i></strong>
              </div></a>
            </div>
            <ul class="nav-menu list-unstyled d-flex flex-md-row align-items-md-center">
              <!-- Notifications dropdown-->
              <li class="nav-item dropdown">
                <a aria-expanded="false" aria-haspopup="true" class="nav-link" data-target="#" data-toggle="dropdown" href="#" id="notifications" rel="nofollow"><i class="fa fa-bell"></i></a>
                <ul aria-labelledby="notifications" class="dropdown-menu">
                  <li>
                    <a class="dropdown-item all-notifications text-center" href="#" rel="nofollow"><strong><i class="fa fa-bell"></i>No notifications</strong></a>
                  </li>
                </ul>
              </li><!-- Messages dropdown-->
              <li class="nav-item dropdown">
                <a aria-expanded="false" aria-haspopup="true" class="nav-link" data-target="#" data-toggle="dropdown" href="#" id="messages" rel="nofollow"><i class="fa fa-envelope"></i></a>
                <ul aria-labelledby="notifications" class="dropdown-menu">
                  <li>
                    <a class="dropdown-item all-notifications text-center" href="#" rel="nofollow"><strong><i class="fa fa-envelope"></i>No messages</strong></a>
                  </li>
                </ul>
              </li><!-- Languages dropdown    -->
              <li class="nav-item dropdown">
                <a aria-expanded="false" aria-haspopup="true" class="nav-link language dropdown-toggle" data-target="#" data-toggle="dropdown" href="#" id="languages" rel="nofollow"><img alt="Taiwan" src="../static/img/flags/16/TW.png"><span class="d-none d-sm-inline-block">Taiwan</span></a>
                <ul aria-labelledby="languages" class="dropdown-menu">
                  <li>
                    <a class="dropdown-item" href="#" rel="nofollow"><img alt="English" class="mr-2" src="../static/img/flags/16/US.png"><span>USA</span></a>
                  </li>
                  <li>
                    <a class="dropdown-item" href="#" rel="nofollow"><img alt="Japanines" class="mr-2" src="../static/img/flags/16/JP.png"><span>Japan</span></a>
                  </li>
                </ul>
              </li><!-- Log out-->
             
            </ul>
          </div>
        </div>
      </nav>
    </header><!-- Counts Section -->
    <section class="statistics section-padding">
      <div class="container-fluid">
        <div class="row d-flex" id="contant_department">       
          {% for auctionData in res['auctionData'] %}
        <div class="col-4">
            <div class="card income text-center">
            
              <div class="display h2" id="carFactory{{ auctionData['auctionApplyNo']}}"></div><div class="display h2" id="carType{{ auctionData['auctionApplyNo']}}"></div>
              <img class="card-img-top" src="https://www.motorbeam.com/wp-content/uploads/Toyota-Corolla-Altis-Colours.jpg">
              <div class="card-body">
                
                <div class="display h2" id="carYears{{ auctionData['auctionApplyNo']}}" ></div>

                  <input type="hidden" id="test{{ auctionData['auctionApplyNo']}}" value="{{ auctionData['carContractAddr'] }}">
                  <input type="hidden" id="carPeople{{ auctionData['auctionApplyNo']}}" value="{{ auctionData['name'] }}">
                  <input type="hidden" id="carAuction{{ auctionData['auctionApplyNo']}}" value="{{ auctionData['auctioneerName'] }}">
            <div class="card-fotter">
              <button class="btn btn-primary btn-block" data-target="#CarRecord" data-toggle="modal"  data-whatever="{{ auctionData['carContractAddr'] }}">詳細資訊</button>
              
            </div>
          </div>
                   
               
        </div>
      </div>
        {% endfor %}
            
    </div>

    <div aria-hidden="true" aria-labelledby="myLargeModalLabel" class="modal fade bd-example-modal-lg" id="CarRecord" role="dialog" tabindex="-1">
      <div class="modal-dialog modal-lg" role="document">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title text-center" id="exampleModalLabel"></h5><button aria-label="Close" class="close" data-dismiss="modal" type="button"><span aria-hidden="true">&times;</span></button>
          </div>
          <div class="modal-body">
            <div id="carFactoryDetail"></div><br>
            <div id="carTypeDetail"></div><br>
            <div id="carColor"></div><br>
            <div id="carYears"></div><br>
            <div id="carLoading"></div><br>
            <div id="carOrder"></div><br>
            <div id="carSales"></div><br>
            <table class="table table-striped table-hover">
                  <thead>
                    <tr>
                      <th>#</th>
                      <th>維修廠商</th>
                      <th>維修日期</th>       
                      <th>里程</th>
                      <th>維修類型</th>                     
                      <th>維修項目</th>                     
                    </tr>
                  </thead>
                  <tbody id="maintanceRecord">
                  </tbody>
                </table>
          </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
                
          </div>
        </div>
      </div>
    </div>

    </section>


  
 
    
         
 <!-- Updates Section -->
    <footer class="main-footer">
      <div class="container-fluid">
        <div class="row">
          <div class="col-sm-6">
            <p>NTUT IFM &copy; 2018</p>
          </div>
          <div class="col-sm-6 text-right">
            <p>Design by <a class="external" href="https://www.facebook.com/chung.h.lin.9">NTUT IFM JyunHao</a></p><!-- Please do not remove the backlink to us unless you support further theme's development at https://bootstrapious.com/donate. It is part of the license conditions and it helps me to run Bootstrapious. Thank you for understanding :)-->
          </div>
        </div>
      </div>
    </footer>
  </div><!-- JavaScript files-->
  <!-- JavaScript files-->
    <script src="{{ url_for('static', filename='js/jquery.min.js') }}"></script>
    <script src="{{ url_for('static', filename='js/umd/popper.min.js') }}"> </script>
    <script src="{{ url_for('static', filename='js/bootstrap.min.js') }}"></script>
    <script src="{{ url_for('static', filename='js/grasp_mobile_progress_circle-1.0.0.min.js') }}"></script>
    <script src="{{ url_for('static', filename='js/jquery.cookie.js') }}"> </script>
    <script src="{{ url_for('static', filename='js/Chart.min.js') }}"></script>
    <script src="{{ url_for('static', filename='js/jquery.validate.min.js') }}"></script>
    <script src="{{ url_for('static', filename='js/jquery.mCustomScrollbar.concat.min.js') }}"></script>
     <script src="{{ url_for('static', filename='js/web3.js') }}"></script>
 <!--  <script src="../static/js/jquery.min.js">
  </script> 
  <script src="../static/js/umd/popper.min.js">
  </script> 
  <script src="../static/js/bootstrap.min.js">
  </script> 
  <script src="../static/js/grasp_mobile_progress_circle-1.0.0.min.js">
  </script> 
  <script src="../static/js/jquery.cookie.js">
  </script> 
  <script src="../static/js/Chart.min.js">
  </script> 
  <script src="../static/js/jquery.validate.min.js">
  </script> 
  <script src="../static/js/jquery.mCustomScrollbar.concat.min.js">
  </script> --> <!-- Main File-->
   <script src="{{ url_for('static', filename='js/front.js') }}"></script>
   
 <!--  <script src="../static/js/front.js"></script>  -->
  <script type="text/javascript">
    
    var carOrder;
    var carAuction;
    var web3 = require('web3');
    var web3 = new web3()
    if(!web3.currentProvider)
      web3.setProvider(new web3.providers.HttpProvider('http://localhost:8545'));

    var TestContract = web3.eth.contract([
        {
            "constant": false,
            "inputs": [
                {
                    "name": "_fixRecord",
                    "type": "address"
                }
            ],
            "name": "setFixRecord",
            "outputs": [
                {
                    "name": "Successed",
                    "type": "bool"
                }
            ],
            "payable": false,
            "stateMutability": "nonpayable",
            "type": "function"
        },
        {
            "constant": true,
            "inputs": [],
            "name": "getCarInfos",
            "outputs": [
                {
                    "name": "",
                    "type": "string"
                },
                {
                    "name": "",
                    "type": "string"
                },
                {
                    "name": "",
                    "type": "string"
                },
                {
                    "name": "",
                    "type": "uint256"
                },
                {
                    "name": "",
                    "type": "string"
                },
                {
                    "name": "",
                    "type": "string"
                },
                {
                    "name": "",
                    "type": "uint256"
                },
                {
                    "name": "",
                    "type": "address[]"
                }
            ],
            "payable": false,
            "stateMutability": "view",
            "type": "function"
        },
        {
            "constant": true,
            "inputs": [],
            "name": "getAddr",
            "outputs": [
                {
                    "name": "",
                    "type": "address"
                }
            ],
            "payable": false,
            "stateMutability": "view",
            "type": "function"
        },
        {
            "constant": false,
            "inputs": [
                {
                    "name": "_licencePlateNumber",
                    "type": "string"
                },
                {
                    "name": "_engineSerialNumber",
                    "type": "string"
                },
                {
                    "name": "_factory",
                    "type": "string"
                },
                {
                    "name": "_carYears",
                    "type": "uint256"
                },
                {
                    "name": "_carStyle",
                    "type": "string"
                },
                {
                    "name": "_carColor",
                    "type": "string"
                },
                {
                    "name": "_carLoading",
                    "type": "uint256"
                }
            ],
            "name": "updateCarInfo",
            "outputs": [
                {
                    "name": "Successed",
                    "type": "bool"
                }
            ],
            "payable": false,
            "stateMutability": "nonpayable",
            "type": "function"
        },
        {
            "inputs": [
                {
                    "name": "_licencePlateNumber",
                    "type": "string"
                },
                {
                    "name": "_engineSerialNumber",
                    "type": "string"
                },
                {
                    "name": "_factory",
                    "type": "string"
                },
                {
                    "name": "_carYears",
                    "type": "uint256"
                },
                {
                    "name": "_carStyle",
                    "type": "string"
                },
                {
                    "name": "_carColor",
                    "type": "string"
                },
                {
                    "name": "_carLoading",
                    "type": "uint256"
                }
            ],
            "payable": false,
            "stateMutability": "nonpayable",
            "type": "constructor"
        },
        {
            "anonymous": false,
            "inputs": [
                {
                    "indexed": false,
                    "name": "addr",
                    "type": "address"
                },
                {
                    "indexed": false,
                    "name": "Successed",
                    "type": "bool"
                }
            ],
            "name": "LogUpdateCarInfo",
            "type": "event"
        },
        {
            "anonymous": false,
            "inputs": [
                {
                    "indexed": false,
                    "name": "addr",
                    "type": "address"
                },
                {
                    "indexed": false,
                    "name": "Successed",
                    "type": "bool"
                }
            ],
            "name": "LogGetCarInfos",
            "type": "event"
        },
        {
            "anonymous": false,
            "inputs": [
                {
                    "indexed": false,
                    "name": "addr",
                    "type": "address"
                },
                {
                    "indexed": false,
                    "name": "Successed",
                    "type": "bool"
                }
            ],
            "name": "LogSetFixRecord",
            "type": "event"
        },
        {
            "anonymous": false,
            "inputs": [
                {
                    "indexed": false,
                    "name": "addr",
                    "type": "address"
                },
                {
                    "indexed": false,
                    "name": "Successed",
                    "type": "bool"
                }
            ],
            "name": "LogUpdateCarDataLst",
            "type": "event"
        }
    ]);
  
        
        {% for auctionData in res['auctionData'] %}

        var addr = document.getElementById("test{{ auctionData['auctionApplyNo'] }}").value; 
        var testContract = TestContract.at(addr);

        console.log(addr);
        console.log(testContract);
        var result = testContract.getCarInfos();
        console.log(result);

        document.getElementById("carFactory{{ auctionData['auctionApplyNo']}}").innerHTML = result[2];
        document.getElementById("carType{{ auctionData['auctionApplyNo']}}").innerHTML = result[4];       
        document.getElementById("carYears{{ auctionData['auctionApplyNo']}}").innerHTML = result[3];
        carOrder = document.getElementById("carPeople{{ auctionData['auctionApplyNo']}}").value;
        carAuction = document.getElementById("carAuction{{ auctionData['auctionApplyNo']}}").value;
        
         // var result_1 = testContract.set(str);
         // console.log(result_1);

       
         {% endfor %}



        $('#CarRecord').on('show.bs.modal', function (event) {
        var button = $(event.relatedTarget) // Button that triggered the modal
        var recipient = button.data('whatever')
        
        var maintanceRecord = document.getElementById("maintanceRecord");
         // Extract info from data-* attributes
        // If necessary, you could initiate an AJAX request here (and then do the updating in a callback).
        // Update the modal's content. We'll use jQuery here, but you could use a data binding library or other methods instead.
        var modal = $(this)
        


        var testContract = TestContract.at(recipient);
        var CarRecordResult = testContract.getCarInfos();
          
        
        modal.find('.modal-title').text( CarRecordResult[2] + "  "+CarRecordResult[4] );
        
        modal.find('#carFactoryDetail').text('汽車廠商：'+ CarRecordResult[2]);
        modal.find('#carTypeDetail').text('汽車型號：'+ CarRecordResult[4]);
        modal.find('#carColor').text('汽車顏色：'+ CarRecordResult[5]);
        modal.find('#carYears').text('出廠年份：'+ CarRecordResult[3]);
        modal.find('#carLoading').text('座位人數：'+ CarRecordResult[6]+"人座");
        modal.find('#carOrder').text('車主：'+ carOrder);
        modal.find('#carSales').text('拍賣商：'+ carAuction);


         while (maintanceRecord.firstChild) {
            maintanceRecord.removeChild(maintanceRecord.firstChild);
        }
        for(var i=0; i<CarRecordResult[7].length;i++){


        
         var getFixRecordContract = web3.eth.contract([
  {
    "constant": true,
    "inputs": [],
    "name": "getMaintananceInfo",
    "outputs": [
      {
        "name": "",
        "type": "address"
      },
      {
        "name": "",
        "type": "string"
      },
      {
        "name": "",
        "type": "string"
      },
      {
        "name": "",
        "type": "uint256"
      },
      {
        "name": "",
        "type": "string"
      },
      {
        "name": "",
        "type": "string"
      }
    ],
    "payable": false,
    "stateMutability": "view",
    "type": "function"
  },
  {
    "constant": true,
    "inputs": [],
    "name": "getAddr",
    "outputs": [
      {
        "name": "",
        "type": "address"
      }
    ],
    "payable": false,
    "stateMutability": "view",
    "type": "function"
  },
  {
    "inputs": [
      {
        "name": "_carAddr",
        "type": "address"
      },
      {
        "name": "_fixFactoryID",
        "type": "string"
      },
      {
        "name": "_fixDate",
        "type": "string"
      },
      {
        "name": "_mileage",
        "type": "uint256"
      },
      {
        "name": "_fixType",
        "type": "string"
      },
      {
        "name": "_fixList",
        "type": "string"
      }
    ],
    "payable": false,
    "stateMutability": "nonpayable",
    "type": "constructor"
  }
]);


    var testContract = getFixRecordContract.at(CarRecordResult[7][i]);
    var maintance = testContract.getMaintananceInfo();

     
    // console.log(maintanceRecord);
    console.log(maintance[1]);

   
       
    var newTr = document.createElement('tr');
    var newTh = document.createElement('th');
    var newNo = document.createTextNode(i+1);

    newTh.appendChild(newNo);
     newTr.appendChild(newTh);
     for(var j=1;j< maintance.length;j++){
       console.log(maintance[1]);
    var newTd = document.createElement('td');
    var newRecord = document.createTextNode(maintance[j]);
    newTd.appendChild(newRecord);
    newTr.appendChild(newTd);


      }
   maintanceRecord.appendChild(newTr);
    
        

        }
        
      })


 

  </script>

</body>
</html>